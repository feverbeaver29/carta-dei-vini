<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registrazione</title>
<style>
body { font-family: sans-serif; background: #fff9f4; color: #333; padding: 2em; }
form { max-width: 400px; margin: auto; background: white; padding: 2em; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
input, button { width: 100%; padding: 0.8em; margin: 0.5em 0; }
button { background: #b00; color: white; border: none; border-radius: 8px; cursor: pointer; }
</style>
</head>
<body>

<h2>Registrati</h2>
<form onsubmit="register(event)">
  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  <input type="text" id="nomeRistorante" placeholder="Nome Ristorante" required>
  <button>Registrati</button>
</form>

<!-- Bottone per registrarsi con Google -->
<button onclick="signInWithGoogle()">Registrati con Google</button>

<script>
const SUPABASE_URL = "https://ldunvbftxhbtuyabgxwh.supabase.co";
const SUPABASE_API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxkdW52YmZ0eGhidHV5YWJneHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY0NTMyOTYsImV4cCI6MjA2MjAyOTI5Nn0.0hjJASFktfHZHjVQzX9bq8xGBrf7o1Fya6lqnA2tvPo";

function register(e) {
  e.preventDefault();
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const nomeRistorante = document.getElementById('nomeRistorante').value;

  fetch(`${SUPABASE_URL}/auth/v1/signup`, {
    method: "POST",
    headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_API_KEY },
    body: JSON.stringify({ email, password })
  }).then(res => res.json()).then(data => {
    if (!data.error) {
      fetch(`${SUPABASE_URL}/rest/v1/ristoranti`, {
        method: "POST",
        headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_API_KEY, 'Prefer': 'return=representation' },
        body: JSON.stringify({ id: data.id || data.user?.id, nome: nomeRistorante, palette_color: "rosso", email: email })
      });
      alert("Registrazione completata!");
      window.location.href = "login.html";
    } else {
      alert("Errore nella registrazione: " + (data.msg || JSON.stringify(data)));
    }
  });
}

function signInWithGoogle() {
  const redirectTo = window.location.origin + "/dashboard.html";
  window.location.href = `${SUPABASE_URL}/auth/v1/authorize?provider=google&redirect_to=${redirectTo}`;
}
</script>

</body>
</html>