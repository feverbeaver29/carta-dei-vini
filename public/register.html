<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registrazione - Wine's Fever</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.42.3/dist/umd/supabase.min.js"></script>
  <style>
    body {
      background-color: #fff9f4;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #ffffff;
      padding: 40px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      max-width: 420px;
      width: 100%;
    }
    h1 {
      color: #b00;
      margin-bottom: 1.2rem;
      text-align: center;
    }
    label {
      display: block;
      margin-top: 1.2rem;
      font-weight: 600;
    }
    input[type="email"],
    input[type="password"],
    input[type="text"] {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    .toggle-password {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }
    .password-wrapper {
      position: relative;
    }
    .password-strength {
      font-size: 0.85em;
      color: #888;
      margin-top: 5px;
    }
    .error {
      color: #c00;
      font-size: 0.9em;
      margin-top: 5px;
    }
    .btn, .google-btn {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn {
      background-color: #b00;
      color: white;
    }
    .btn:hover {
      background-color: #800000;
    }
    .google-btn {
      background-color: #4285F4;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .google-btn img {
      width: 24px;
    }
    .message {
      margin-top: 15px;
      font-size: 0.95em;
      text-align: center;
    }
    .privacy {
      margin-top: 12px;
      font-size: 0.85em;
      text-align: center;
    }
    .checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 1rem;
    }
    footer {
      text-align: center;
      margin-top: 2rem;
      font-size: 0.85em;
      color: #aaa;
    }
    .topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom: 10px;
}
.lang-wrap{
  display:flex;
  align-items:center;
  gap:8px;
}
.lang-wrap label{ margin:0; font-size:0.9em; color:#555; font-weight:500; }
.lang-wrap select{
  padding:6px 10px;
  border-radius:10px;
  border:1px solid #ccc;
  background:#fff;
}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
  <div></div>
  <div class="lang-wrap">
    <label id="langLabel" for="langSelect">Lingua</label>
    <select id="langSelect">
      <option value="it">Italiano</option>
      <option value="en">English</option>
      <option value="fr">Fran√ßais</option>
      <option value="es">Espa√±ol</option>
    </select>
  </div>
</div>
    <h1 data-i18n="title">Crea un account</h1>
    <label for="email" data-i18n="email_lbl">Email *</label>
    <input type="email" id="email" required data-i18n-placeholder="email_ph" placeholder="Email">
    
<label for="password" data-i18n="password_lbl">Password *</label>
    <div class="password-wrapper">
      <input type="password" id="password" minlength="6" required oninput="checkPasswordStrength()"
       data-i18n-placeholder="password_ph" placeholder="Password">
      <span class="toggle-password" onclick="toggleVisibility('password')">üëÅÔ∏è</span>
    </div>
    <div class="password-strength" id="passwordStrength" data-i18n="pw_hint"></div>

    <label for="confirmPassword" data-i18n="confirm_lbl">Conferma Password *</label>
    <div class="password-wrapper">
      <input type="password" id="confirmPassword" required data-i18n-placeholder="confirm_ph" placeholder="Conferma password">
      <span class="toggle-password" onclick="toggleVisibility('confirmPassword')">üëÅÔ∏è</span>
    </div>

    <label for="ristorante" data-i18n="restaurant_lbl">Nome Ristorante *</label>
    <input type="text" id="ristorante" required data-i18n-placeholder="restaurant_ph" placeholder="Nome ristorante">

    <div class="checkbox">
      <input type="checkbox" id="acceptPrivacy" required>
      <label for="acceptPrivacy" data-i18n="privacy_html">Accetto la <a href="privacy.html" target="_blank">Privacy Policy</a>
      </label>
    </div>

    <button class="btn" onclick="register()" data-i18n="register_btn">Registrati</button>

    <div class="google-btn" onclick="registerWithGoogle()">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google Icon">
      <span data-i18n="register_google">Registrati con Google</span>
    </div>

    <div class="message" id="messageBox"></div>
    <footer data-i18n="footer">¬© 2025 Wine's Fever - Tutti i diritti riservati</footer>
  </div>

<script>
  const SUPABASE_URL = "https://ldunvbftxhbtuyabgxwh.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxkdW52YmZ0eGhidHV5YWJneHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY0NTMyOTYsImV4cCI6MjA2MjAyOTI5Nn0.0hjJASFktfHZHjVQzX9bq8xGBrf7o1Fya6lqnA2tvPo";
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // ==========================
// i18n (Register)
// ==========================
const SUPPORTED_LANGS = ["it","en","fr","es"];
let currentLang = "it";

  const TRANSLATIONS = {
  it:{
    language:"Lingua",
    title:"Crea un account",
    email_lbl:"Email *",
    password_lbl:"Password *",
    confirm_lbl:"Conferma Password *",
    restaurant_lbl:"Nome Ristorante *",
    privacy_html:'Accetto la <a href="privacy.html" target="_blank">Privacy Policy</a>',
    register_btn:"Registrati",
    register_google:"Registrati con Google",
    footer:"¬© 2025 Wine's Fever - Tutti i diritti riservati",
    pw_short:"Password troppo corta",
    pw_mid:"Aggiungi almeno una maiuscola e un numero",
    pw_ok:"Password sicura",
    must_accept:"Devi accettare la Privacy Policy per continuare.",
    pw_not_match:"Le password non coincidono.",
    reg_err:"Errore registrazione: ",
    save_rest_err:"Registrazione ok, ma errore nel salvare il nome del ristorante.",
    google_err:"Errore con Google: ",
    email_ph:"Inserisci la tua email",
    password_ph:"Inserisci la password",
    confirm_ph:"Conferma la password",
    restaurant_ph:"Nome del ristorante",
    pw_hint:"", // (pu√≤ rimanere vuoto: lo riempiamo in checkPasswordStrength)
  },
  en:{
    language:"Language",
    title:"Create an account",
    email_lbl:"Email *",
    password_lbl:"Password *",
    confirm_lbl:"Confirm password *",
    restaurant_lbl:"Restaurant name *",
    privacy_html:'I accept the <a href="privacy.html" target="_blank">Privacy Policy</a>',
    register_btn:"Sign up",
    register_google:"Continue with Google",
    footer:"¬© 2025 Wine's Fever - All rights reserved",
    pw_short:"Password too short",
    pw_mid:"Add at least one uppercase letter and one number",
    pw_ok:"Strong password",
    must_accept:"You must accept the Privacy Policy to continue.",
    pw_not_match:"Passwords do not match.",
    reg_err:"Signup error: ",
    save_rest_err:"Signup ok, but error saving the restaurant name.",
    google_err:"Google error: ",
    email_ph:"Enter your email",
password_ph:"Enter your password",
confirm_ph:"Confirm your password",
restaurant_ph:"Restaurant name",
pw_hint:"",
  },
  fr:{
    language:"Langue",
    title:"Cr√©er un compte",
    email_lbl:"E-mail *",
    password_lbl:"Mot de passe *",
    confirm_lbl:"Confirmer le mot de passe *",
    restaurant_lbl:"Nom du restaurant *",
    privacy_html:'J‚Äôaccepte la <a href="privacy.html" target="_blank">Politique de confidentialit√©</a>',
    register_btn:"S‚Äôinscrire",
    register_google:"Continuer avec Google",
    footer:"¬© 2025 Wine's Fever - Tous droits r√©serv√©s",
    pw_short:"Mot de passe trop court",
    pw_mid:"Ajoutez au moins une majuscule et un chiffre",
    pw_ok:"Mot de passe s√©curis√©",
    must_accept:"Vous devez accepter la politique de confidentialit√© pour continuer.",
    pw_not_match:"Les mots de passe ne correspondent pas.",
    reg_err:"Erreur d‚Äôinscription : ",
    save_rest_err:"Inscription ok, mais erreur lors de l‚Äôenregistrement du restaurant.",
    google_err:"Erreur Google : ",
    email_ph:"Saisissez votre e-mail",
password_ph:"Saisissez votre mot de passe",
confirm_ph:"Confirmez le mot de passe",
restaurant_ph:"Nom du restaurant",
pw_hint:"",
  },
  es:{
    language:"Idioma",
    title:"Crear una cuenta",
    email_lbl:"Email *",
    password_lbl:"Contrase√±a *",
    confirm_lbl:"Confirmar contrase√±a *",
    restaurant_lbl:"Nombre del restaurante *",
    privacy_html:'Acepto la <a href="privacy.html" target="_blank">Pol√≠tica de privacidad</a>',
    register_btn:"Registrarse",
    register_google:"Continuar con Google",
    footer:"¬© 2025 Wine's Fever - Todos los derechos reservados",
    pw_short:"Contrase√±a demasiado corta",
    pw_mid:"A√±ade al menos una may√∫scula y un n√∫mero",
    pw_ok:"Contrase√±a segura",
    must_accept:"Debes aceptar la Pol√≠tica de privacidad para continuar.",
    pw_not_match:"Las contrase√±as no coinciden.",
    reg_err:"Error de registro: ",
    save_rest_err:"Registro ok, pero error al guardar el restaurante.",
    google_err:"Error con Google: ",
    email_ph:"Introduce tu email",
password_ph:"Introduce tu contrase√±a",
confirm_ph:"Confirma la contrase√±a",
restaurant_ph:"Nombre del restaurante",
pw_hint:"",
  }
};

function normalizeLang(raw){
  const s=(raw||"").toLowerCase();
  if (s.startsWith("it")) return "it";
  if (s.startsWith("fr")) return "fr";
  if (s.startsWith("es")) return "es";
  return "en";
}
function t(key){
  const dict = TRANSLATIONS[currentLang] || TRANSLATIONS.en;
  return (dict && dict[key]) || (TRANSLATIONS.en && TRANSLATIONS.en[key]) || key;
}
function setLang(lang, persist=true){
  currentLang = SUPPORTED_LANGS.includes(normalizeLang(lang)) ? normalizeLang(lang) : "en";
  document.documentElement.lang = currentLang;
  if (persist) localStorage.setItem("wf_lang", currentLang);
  const sel = document.getElementById("langSelect");
  if (sel) sel.value = currentLang;
  applyTranslations();
  checkPasswordStrength();
}
function initLanguage(){
  const qp = new URLSearchParams(window.location.search);
  const langFromUrl = qp.get("lang");
  const saved = localStorage.getItem("wf_lang");
  const auto  = normalizeLang(navigator.language||"");
  setLang(langFromUrl || saved || auto, !saved);

  const sel = document.getElementById("langSelect");
  if (sel){
    sel.addEventListener("change", e => setLang(e.target.value, true));
  }
}
function applyTranslations(){
  const langLbl = document.getElementById("langLabel");
  if (langLbl) langLbl.textContent = t("language");

  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    if (key === "pw_hint") return; // non sovrascrivere la strength dinamica
    if (key === "privacy_html") el.innerHTML = t(key);
    else el.textContent = t(key);
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
    el.setAttribute("placeholder", t(el.getAttribute("data-i18n-placeholder")));
  });
}

  function toggleVisibility(id) {
    const field = document.getElementById(id);
    field.type = field.type === "password" ? "text" : "password";
  }

  function checkPasswordStrength() {
    const password = document.getElementById('password').value;
    const strengthBox = document.getElementById('passwordStrength');
    if (password.length < 6) {
      strengthBox.textContent = t("pw_short");
      strengthBox.style.color = "#c00";
    } else if (!/[A-Z]/.test(password) || !/[0-9]/.test(password)) {
      strengthBox.textContent = t("pw_mid");
      strengthBox.style.color = "#b36b00";
    } else {
      strengthBox.textContent = t("pw_ok");
      strengthBox.style.color = "green";
    }
  }

  async function register() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const ristorante = document.getElementById('ristorante').value;
    const privacyAccepted = document.getElementById('acceptPrivacy').checked;
    const messageBox = document.getElementById('messageBox');

    if (!privacyAccepted) return alert(t("must_accept"))
    if (password !== confirmPassword) return alert(t("pw_not_match"))

    const { data, error } = await sb.auth.signUp({ email, password });
    if (error) return alert(t("reg_err") + error.message)

    const userId = data.user.id;
    // salva lingua anche ‚Äúper ristorante‚Äù (sync con dashboard/admin)
localStorage.setItem(`wf_lang_${userId}`, currentLang);
    const { error: insertError } = await sb.from('ristoranti').insert([
      { id: userId, nome: ristorante, email: email }
    ]);
    if (insertError) return alert(t("save_rest_err"))

window.location.href = `email-inviata.html?lang=${currentLang}`;

  }

  async function registerWithGoogle() {
    const { data, error } = await sb.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: window.location.origin + '/setup-ristorante.html'
      }
    });
    if (error) alert(t("google_err") + error.message);
  }
  document.addEventListener("DOMContentLoaded", () => {
  initLanguage();
  applyTranslations();
});
</script>
</body>
</html>


